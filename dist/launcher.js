var m="__launcher_image_data_url_cache__",h=class{constructor(){this.name="",this.package="",this.activity=""}},c=class extends Error{constructor(e){super("LauncherResponseError: "+e)}},w=r=>new Request(r,{method:"GET"}),b=r=>new Response(r,{status:200}),_=async r=>{if(r.startsWith("http"))try{let e=await self.caches.open(m),n=w(r),t=await e.match(n,{ignoreMethod:!0,ignoreSearch:!1,ignoreVary:!0});if(t)return await t.text()}catch(e){console.error(e)}},E=async(r,e)=>{if(r.startsWith("http"))try{let n=await self.caches.open(m),t=w(r),o=b(e);await n.delete(t,{ignoreMethod:!0,ignoreSearch:!1,ignoreVary:!0}),await n.put(t,o)}catch(n){console.error(n)}},k=r=>r.startsWith("http")?new Promise((e,n)=>{let t=new Image,o=()=>{let s=document.createElement("canvas");s.width=t.width,s.height=t.height,s.getContext("2d").drawImage(t,0,0),e(s.toDataURL())},i=s=>{n(s)};t.addEventListener("load",o),t.addEventListener("error",i),t.crossOrigin="anonymous",t.src=r+`&t=${new Date().getTime()}`}):r,A=async(r,e=!1)=>{let n=await _(r);if(typeof n!="string")e=!0;else return n;if(e){let t=await k(r);return await E(r,t),t}};var y="__store_permissions__",u=class{constructor(e=Math.PI*Math.PI){this.seed=e}nextInt(e,n){let t=Number.parseFloat("0."+Math.sin(this.seed++).toString().substr(6));return e=Math.ceil(e),n=Math.floor(n),Math.floor(t*(n-e))+e}},S=128,$=["otren","nlttvwrarc","fhoiaii","eehednt","xeomlea","ennsheey","msapeg","etauwilash","ytfi","hosodad","cemehn","inra","oeeow","dubeto","mauetehs","deetrtre","lelsiid","nkghs","admiat","iadh","hoyu","mhyiiltaafm","hrwjaw"],I=["#f44336","#e91e63","#e91e63","#7e57c2","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722"],P=function(r){let e=r.nextInt(0,$.length);return $[e]},l=function(r){let e=r.nextInt(0,I.length);return I[e]},v=function(r){return r.replace(/^./u,r.charAt(0).toUpperCase())},L=function(r=Math.PI*Math.PI,e=50){let n=[],t={},o=new u(r);for(let i=0;i<e;i++){let s=o.nextInt(1,4),a=new h;for(let g=0;g<s;g++){let f=P(o);a.name+=v(f)+" ",a.package+=f+"."}a.activity=a.package+"MainActivity",a.name=a.name.substring(0,a.name.length-1),a.package=a.package.substring(0,a.package.length-1);let x=[l(o),l(o),l(o)];t[a.package]=x,n.push(a)}return[n,t]},[R,M]=L(),d=class{#e={};constructor(){this.#e={},this.#t()}#n(){return!!this.#e.launcher}#t(){let e=sessionStorage.getItem(y);if(e)try{this.#e=JSON.parse(e)}catch(n){console.error(n)}}#r(){sessionStorage.setItem(y,JSON.stringify(this.#e))}async getApplicationList(){if(!this.#n())throw console.error("getApplicationList: You need request permission first!"),new c("No Permission");return R}getApplicationIconSrc(e,n,t=S){let o;if(e!=null)o=M[e];else{let s=new u(Math.random()*Number.MAX_SAFE_INTEGER);o=[l(s),l(s),l(s)]}let i=`<svg width="${t}" height="${t}" xmlns="http://www.w3.org/2000/svg">
        <g>
        <rect x="-1" y="-1" width="${t+2}" height="${t+2}" id="canvas_background" fill="none"/>
        </g>
        <g>
        <ellipse ry="${t/2.2}" rx="${t/2.2}" id="svg_3" cy="${t/2}" cx="${t/2}" stroke-width="0" stroke="#000" fill="${o[0]}"/>
        <ellipse ry="${t/3}" rx="${t/3}" id="svg_3" cy="${t/2}" cx="${t/2}" stroke-width="0.5" stroke="#000" fill="${o[1]}"/>
        <ellipse ry="${t/5}" rx="${t/5}" id="svg_3" cy="${t/2}" cx="${t/2}" stroke-width="0" stroke="#000" fill="${o[2]}"/>
        </g>
        </svg>`;return"data:image/svg+xml;base64,"+btoa(i)}async launchApplication(e,n){if(!this.#n())throw console.error("launchApplication: You need request permission first!"),new c("No Permission");let t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.background="black",t.style.position="fixed",t.style.top=0,t.style.right=0,t.style.bottom=0,t.style.left=0,t.style.textAlign="center",t.style.padding="1em",t.style.boxSizing="border-box",t.onclick=function(a){a.preventDefault(),a.stopPropagation(),document.body.removeChild(t)};let o=document.createElement("h1");o.innerText="Application",o.style.color="white",o.style.wordBreak="break-all",t.appendChild(o);let i=document.createElement("h3");i.innerText=e,i.style.color="white",i.style.wordBreak="break-all",t.appendChild(i);let s=document.createElement("h3");return s.innerText=n,s.style.color="white",s.style.wordBreak="break-all",t.appendChild(s),document.body.appendChild(t),!0}async openWebpage(e){if(!this.#n())throw console.error("openWebpage: You need request permission first!"),new c("No Permission");return window.open(e,"_blank"),!0}async requestPermission(e){let n={launcher:"Launcher"};if(!["launcher"].includes(e))throw console.error("requestPermission: Permission name not support!"),new c("Permission name not support");if(this.#e[e])return!0;if(confirm(`Do you want to grant ${n[e]} permission to ${window.location.origin} ?`))return this.#e[e]=!0,this.#r(),!0;throw new c("Permission denided")}};var C="launcher",p=class{#e=!1;#n="";#t=void 0;constructor(){this.PERMISSION_LAUNCHER="launcher";let e=10801;try{let o=/WebLauncher\/\d*? \(port (\d*?)\)/g.exec(navigator.userAgent)[1];e=Number.parseInt(o),(o==null||e<=0||e>65535)&&(e=10801,this.#e=!0)}catch{console.log("error, default port!",e),this.#e=!0}console.log("using port:",e);let n=window.location.protocol;n!=="http:"&&(n="https:"),this.#n=`${n}//127.0.0.1:${e}/api/`,this.#t=void 0}isRunningInLauncher(){return!this.#e}async getApplicationList(){if(this.#t)return await this.#t.getApplicationList();let e=`${this.#n}app-list-all?t=${new Date().getTime()}`,n=await fetch(e);if(n.status!==200)throw new c("status code not 200!");return JSON.parse(await n.text()).map(i=>{let s=new h;return s.name=i.name,s.package=i.package,s.activity=i.activity,s})}getApplicationIconSrc(e,n,t=128){return this.#t?this.#t.getApplicationIconSrc(e,n,t):`${this.#n}icon?package=${e}&activity=${n}&size=${t}`}async launchApplication(e,n){if(this.#t)return await this.#t.launchApplication(e,n);let t=`${this.#n}launch?package=${e}&activity=${n}&t=${new Date().getTime()}`;if((await fetch(t)).status!==200)throw new c("status code not 200!");return!0}async openWebpage(e){if(this.#t)return await this.#t.openWebpage(e);let n=`${this.#n}open-webpage?href=${encodeURIComponent(e)}&t=${new Date().getTime()}`;if((await fetch(n)).status!==200)throw new c("status code not 200!");return!0}async requestPermission(e){if(this.#t)return await this.#t.requestPermission(e);let n=`${this.#n}request-permission?name=${e}&t=${new Date().getTime()}`;if((await fetch(n)).status!==200)throw new c("status code not 200!");return!0}startDebugSession(){this.#t=new d}};var H=new p;export{h as ApplicationInfo,p as Launcher,c as LauncherResponseError,C as PERMISSION_LAUNCHER,A as convertToCachedImageURL,H as launcher};
//# sourceMappingURL=launcher.js.map
